<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Peoplemon: src/Core/Components/Movable.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peoplemon
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">Peoplemon 3 game source documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a2f0e5642e47e7ed59fe0f0829eafb5f.html">Core</a></li><li class="navelem"><a class="el" href="dir_b0c5c39bafac57735243a2df46d7e52b.html">Components</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Movable.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="a00578.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="a00083.html">Core/Components/Movable.hpp</a>&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="a00119.html">Core/Events/EntityMoved.hpp</a>&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="a00275.html">Core/Properties.hpp</a>&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">namespace </span><a class="code" href="a01010.html">core</a></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">namespace </span>component</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div><div class="line"><a name="l00010"></a><span class="lineno"><a class="line" href="a01251.html#a6c7157a7c55d7362357fc6e12962c9e5">   10</a></span>&#160;<a class="code" href="a01251.html#a6c7157a7c55d7362357fc6e12962c9e5">Movable::Movable</a>(<span class="keyword">const</span> bl::entity::Registry::ComponentHandle&lt;component::Position&gt;&amp; pos, <span class="keywordtype">float</span> speed,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                 <span class="keywordtype">float</span> fastSpeed)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;: position(pos)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;, movementSpeed(speed)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;, fastMovementSpeed(fastSpeed)</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;, isMoving(false)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;, movingFast(false) {}</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="a01251.html#a8a843bd9a56205f07badfa288c8e030a">   18</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="a01251.html#a8a843bd9a56205f07badfa288c8e030a">Movable::moving</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> isMoving; }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="a01251.html#a1e22f0d34312a87dcfbfc3d758ac401e">   20</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="a01251.html#a1e22f0d34312a87dcfbfc3d758ac401e">Movable::goingFast</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> movingFast; }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="a01251.html#a09c3a77cd3443d7058d1f695c6a9b205">   22</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="a01251.html#a09c3a77cd3443d7058d1f695c6a9b205">Movable::move</a>(<a class="code" href="a00996.html#ga0192bf5ba1eccc191c8ef1187ce66d69">Direction</a> dir, <span class="keywordtype">bool</span> fast) {</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    moveDir    = dir;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    isMoving   = <span class="keyword">true</span>;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    movingFast = fast;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="a01251.html#acb6ad6d8d963bb8e600704b8ea41d118">   28</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="a01251.html#acb6ad6d8d963bb8e600704b8ea41d118">Movable::update</a>(bl::entity::Entity owner, bl::event::Dispatcher&amp; bus, <span class="keywordtype">float</span> dt) {</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">if</span> (isMoving) {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> speed        = movingFast ? fastMovementSpeed : movementSpeed;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> displacement = dt * speed;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> xTile = position.get().positionTiles().x * <a class="code" href="a01815.html#a3dbd0e08a9910f9755d0e5218ba45f5a">Properties::PixelsPerTile</a>();</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> yTile = position.get().positionTiles().y * <a class="code" href="a01815.html#a3dbd0e08a9910f9755d0e5218ba45f5a">Properties::PixelsPerTile</a>();</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordflow">switch</span> (moveDir) {</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00996.html#gga0192bf5ba1eccc191c8ef1187ce66d69a258f49887ef8d14ac268c92b02503aaa">Direction::Up</a>:</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            position.get().setPixels(position.get().positionPixels() -</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                                     sf::Vector2f(0.f, displacement));</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            <span class="keywordflow">if</span> (position.get().positionPixels().y &lt;= yTile) {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                position.get().setTiles(position.get().positionTiles());</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                isMoving = <span class="keyword">false</span>;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                bus.dispatch&lt;<a class="code" href="a01339.html">event::EntityMoveFinished</a>&gt;({owner, position.get()});</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00996.html#gga0192bf5ba1eccc191c8ef1187ce66d69a92b09c7c48c520c3c55e497875da437c">Direction::Right</a>:</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            position.get().setPixels(position.get().positionPixels() +</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                     sf::Vector2f(displacement, 0.f));</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            <span class="keywordflow">if</span> (position.get().positionPixels().x &gt;= xTile) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                position.get().setTiles(position.get().positionTiles());</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                isMoving = <span class="keyword">false</span>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                bus.dispatch&lt;<a class="code" href="a01339.html">event::EntityMoveFinished</a>&gt;({owner, position.get()});</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            }</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00996.html#gga0192bf5ba1eccc191c8ef1187ce66d69a08a38277b0309070706f6652eeae9a53">Direction::Down</a>:</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            position.get().setPixels(position.get().positionPixels() +</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                                     sf::Vector2f(0.f, displacement));</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            <span class="keywordflow">if</span> (position.get().positionPixels().y &gt;= yTile) {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                position.get().setTiles(position.get().positionTiles());</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                isMoving = <span class="keyword">false</span>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                bus.dispatch&lt;<a class="code" href="a01339.html">event::EntityMoveFinished</a>&gt;({owner, position.get()});</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00996.html#gga0192bf5ba1eccc191c8ef1187ce66d69a945d5e233cf7d6240f6b783b36a374ff">Direction::Left</a>:</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            position.get().setPixels(position.get().positionPixels() -</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                                     sf::Vector2f(displacement, 0.f));</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordflow">if</span> (position.get().positionPixels().x &lt;= xTile) {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                position.get().setTiles(position.get().positionTiles());</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                isMoving = <span class="keyword">false</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                bus.dispatch&lt;<a class="code" href="a01339.html">event::EntityMoveFinished</a>&gt;({owner, position.get()});</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            BL_LOG_WARN &lt;&lt; <span class="stringliteral">&quot;Invalid move dir: &quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(moveDir);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            position.get().setTiles(position.get().positionTiles());</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            isMoving = <span class="keyword">false</span>;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;} <span class="comment">// namespace component</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;} <span class="comment">// namespace core</span></div><div class="ttc" id="a01010_html"><div class="ttname"><a href="a01010.html">core</a></div><div class="ttdoc">Core classes and functionality for both the editor and game. </div><div class="ttdef"><b>Definition:</b> <a href="a02789_source.html#l00014">Conversation.hpp:14</a></div></div>
<div class="ttc" id="a01251_html_a09c3a77cd3443d7058d1f695c6a9b205"><div class="ttname"><a href="a01251.html#a09c3a77cd3443d7058d1f695c6a9b205">core::component::Movable::move</a></div><div class="ttdeci">void move(Direction dir, bool fast)</div><div class="ttdoc">Starts the entity moving in the given direction. Only updates the interpolated position, not the tile position. This does not check collisions. Use the Movement system to ensure the move is valid. </div><div class="ttdef"><b>Definition:</b> <a href="a00578_source.html#l00022">Movable.cpp:22</a></div></div>
<div class="ttc" id="a01339_html"><div class="ttname"><a href="a01339.html">core::event::EntityMoveFinished</a></div><div class="ttdoc">Fired when an entity completes a move from one tile to another. </div><div class="ttdef"><b>Definition:</b> <a href="a00119_source.html#l00048">EntityMoved.hpp:48</a></div></div>
<div class="ttc" id="a00996_html_gga0192bf5ba1eccc191c8ef1187ce66d69a92b09c7c48c520c3c55e497875da437c"><div class="ttname"><a href="a00996.html#gga0192bf5ba1eccc191c8ef1187ce66d69a92b09c7c48c520c3c55e497875da437c">core::component::Direction::Right</a></div></div>
<div class="ttc" id="a01251_html_a1e22f0d34312a87dcfbfc3d758ac401e"><div class="ttname"><a href="a01251.html#a1e22f0d34312a87dcfbfc3d758ac401e">core::component::Movable::goingFast</a></div><div class="ttdeci">bool goingFast() const</div><div class="ttdoc">Returns whether or not the entity is going fast. </div><div class="ttdef"><b>Definition:</b> <a href="a00578_source.html#l00020">Movable.cpp:20</a></div></div>
<div class="ttc" id="a00275_html"><div class="ttname"><a href="a00275.html">Properties.hpp</a></div></div>
<div class="ttc" id="a00083_html"><div class="ttname"><a href="a00083.html">Movable.hpp</a></div></div>
<div class="ttc" id="a00996_html_ga0192bf5ba1eccc191c8ef1187ce66d69"><div class="ttname"><a href="a00996.html#ga0192bf5ba1eccc191c8ef1187ce66d69">core::component::Direction</a></div><div class="ttdeci">Direction</div><div class="ttdoc">Which direction an entity is facing. </div><div class="ttdef"><b>Definition:</b> <a href="a00074_source.html#l00025">Direction.hpp:25</a></div></div>
<div class="ttc" id="a01251_html_a6c7157a7c55d7362357fc6e12962c9e5"><div class="ttname"><a href="a01251.html#a6c7157a7c55d7362357fc6e12962c9e5">core::component::Movable::Movable</a></div><div class="ttdeci">Movable(const bl::entity::Registry::ComponentHandle&lt; component::Position &gt; &amp;pos, float speed, float fastSpeed)</div><div class="ttdoc">Construct a new Movable component. </div><div class="ttdef"><b>Definition:</b> <a href="a00578_source.html#l00010">Movable.cpp:10</a></div></div>
<div class="ttc" id="a00996_html_gga0192bf5ba1eccc191c8ef1187ce66d69a08a38277b0309070706f6652eeae9a53"><div class="ttname"><a href="a00996.html#gga0192bf5ba1eccc191c8ef1187ce66d69a08a38277b0309070706f6652eeae9a53">core::component::Direction::Down</a></div></div>
<div class="ttc" id="a01251_html_acb6ad6d8d963bb8e600704b8ea41d118"><div class="ttname"><a href="a01251.html#acb6ad6d8d963bb8e600704b8ea41d118">core::component::Movable::update</a></div><div class="ttdeci">void update(bl::entity::Entity owner, bl::event::Dispatcher &amp;bus, float dt)</div><div class="ttdoc">Updates the interpolation of the entity if moving. </div><div class="ttdef"><b>Definition:</b> <a href="a00578_source.html#l00028">Movable.cpp:28</a></div></div>
<div class="ttc" id="a00996_html_gga0192bf5ba1eccc191c8ef1187ce66d69a258f49887ef8d14ac268c92b02503aaa"><div class="ttname"><a href="a00996.html#gga0192bf5ba1eccc191c8ef1187ce66d69a258f49887ef8d14ac268c92b02503aaa">core::component::Direction::Up</a></div></div>
<div class="ttc" id="a01815_html_a3dbd0e08a9910f9755d0e5218ba45f5a"><div class="ttname"><a href="a01815.html#a3dbd0e08a9910f9755d0e5218ba45f5a">core::Properties::PixelsPerTile</a></div><div class="ttdeci">static int PixelsPerTile()</div><div class="ttdef"><b>Definition:</b> <a href="a00743_source.html#l00280">Properties.cpp:280</a></div></div>
<div class="ttc" id="a01251_html_a8a843bd9a56205f07badfa288c8e030a"><div class="ttname"><a href="a01251.html#a8a843bd9a56205f07badfa288c8e030a">core::component::Movable::moving</a></div><div class="ttdeci">bool moving() const</div><div class="ttdoc">Returns whether or not the entity is moving. </div><div class="ttdef"><b>Definition:</b> <a href="a00578_source.html#l00018">Movable.cpp:18</a></div></div>
<div class="ttc" id="a00119_html"><div class="ttname"><a href="a00119.html">EntityMoved.hpp</a></div></div>
<div class="ttc" id="a00996_html_gga0192bf5ba1eccc191c8ef1187ce66d69a945d5e233cf7d6240f6b783b36a374ff"><div class="ttname"><a href="a00996.html#gga0192bf5ba1eccc191c8ef1187ce66d69a945d5e233cf7d6240f6b783b36a374ff">core::component::Direction::Left</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 30 2022 03:55:51 for Peoplemon by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
